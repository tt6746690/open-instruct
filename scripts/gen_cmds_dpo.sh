set -e
set -x
CUDA_VISIBLE_DEVICES=5 accelerate launch --mixed_precision fp16 --num_machines 2 --num_processes 2 --use_deepspeed --deepspeed_config_file ds_configs/stage3_no_offloading_accelerate.conf --main_process_ip $master_addr --main_process_port $master_port --machine_rank \$SLURM_PROCID open_instruct/dpo_tune.py --model_name_or_path results/baselines/EleutherAI/pythia-410m-deduped --tokenizer_name results/baselines/EleutherAI/pythia-410m-deduped --gradient_checkpointing --train_file data/processed/ultrafeedback/ultrafeedback_data.jsonl --max_seq_length 2048 --preprocessing_num_workers 32 --per_device_train_batch_size 1 --gradient_accumulation_steps 16 --learning_rate 5e-7 --lr_scheduler_type linear --warmup_ratio 0.1 --weight_decay 0. --num_train_epochs 2 --with_tracking --report_to tensorboard wandb --checkpointing_steps 500 --logging_steps 1 --output_dir results/dpo1/pythia-410m_ultrafeedback